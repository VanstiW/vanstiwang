<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treemap Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        /* 添加一些基本的样式 */
        body {
            font-family: Arial, sans-serif;
        }
        .treemap-container {
            max-width: 960px;
            margin: auto;
        }
    </style>
</head>
<body>
    <div id="treemap" class="treemap-container"></div>

    <script>
        // 异步加载JSON数据
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                createTreemap(data); // 使用加载的数据创建Treemap
            })
            .catch(error => console.error('Error loading the JSON file:', error));

        function createTreemap(data) {
            // 定义图表的宽度和高度
            const width = 928;
            const height = 924;

            // 创建SVG容器
            const svg = d3.select('#treemap').append('svg')
                .attr('width', width)
                .attr('height', height)
                .style('font', '10px sans-serif');

            // 定义Treemap布局和数据
            const root = d3.hierarchy(data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            d3.treemap()
                .size([width, height])
                .padding(1)
                (root);

            // 绘制每个节点
            const leaf = svg.selectAll('g')
                .data(root.leaves())
                .join('g')
                .attr('transform', d => `translate(${d.x0},${d.y0})`);

            leaf.append('rect')
                .attr('id', d => (d.leafUid = `leaf-${d.data.name}`))
                .attr('fill', d => '#ccc')
                .attr('width', d => d.x1 - d.x0)
                .attr('height', d => d.y1 - d.y0);

            leaf.append('text')
                .attr('x', 5)
                .attr('y', 20)
                .text(d => d.data.name);
        }
    </script>
</body>
</html>
